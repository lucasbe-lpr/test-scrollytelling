<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Fonte des Glaciers Alpins : Une Histoire en Donn√©es</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/3.2.0/scrollama.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            line-height: 1.5;
            color: #333;
            background: #f8f9fa;
            overflow-x: hidden;
        }

        #intro {
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 3rem 1rem;
        }

        #intro h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 1rem;
            animation: fadeInDown 1s ease-out;
            max-width: 90%;
        }

        #intro p {
            font-size: clamp(1rem, 3vw, 1.2rem);
            max-width: 600px;
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #scrolly {
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .scroll-graphic {
            position: sticky;
            top: 0;
            width: 100%;
            height: 50vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            z-index: 1;
        }

        .chart-container {
            width: 100%;
            height: 100%;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #chart {
            width: 100%;
            height: 100%;
            max-width: 100%;
        }

        .scroll-text {
            position: relative;
            padding: 0;
            width: 100%;
            z-index: 2;
        }

        .step {
            margin: 0 auto 50vh auto;
            padding: 1.5rem;
            max-width: min(90%, 500px);
            background: rgba(255, 255, 255, 0.97);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        .step:first-child {
            margin-top: 55vh;
        }

        .step.is-active {
            opacity: 1;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .step h2 {
            color: #667eea;
            margin-bottom: 0.8rem;
            font-size: clamp(1.2rem, 4vw, 1.6rem);
            line-height: 1.3;
        }

        .step p {
            font-size: clamp(0.95rem, 2.5vw, 1.05rem);
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .stat {
            font-size: clamp(1.6rem, 5vw, 2.2rem);
            font-weight: bold;
            color: #764ba2;
            display: inline-block;
            margin: 0 0.2rem;
        }

        #conclusion {
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 3rem 1.5rem;
            text-align: center;
        }

        #conclusion h2 {
            font-size: clamp(1.5rem, 5vw, 2.2rem);
            margin-bottom: 1.5rem;
            max-width: 90%;
        }

        #conclusion p {
            font-size: clamp(0.95rem, 2.5vw, 1.1rem);
            max-width: min(90%, 700px);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        /* Optimisations pour petites largeurs (colonnes d'articles) */
        @media (max-width: 600px) {
            .scroll-graphic {
                height: 40vh;
            }

            .step:first-child {
                margin-top: 45vh;
            }

            .step {
                margin-bottom: 45vh;
                padding: 1.2rem;
            }

            .chart-container {
                padding: 0.5rem;
            }

            #intro {
                min-height: 60vh;
                padding: 2rem 1rem;
            }

            #conclusion {
                min-height: 60vh;
                padding: 2rem 1rem;
            }
        }

        /* Pour les tr√®s petites largeurs */
        @media (max-width: 400px) {
            .scroll-graphic {
                height: 35vh;
            }

            .step:first-child {
                margin-top: 40vh;
            }

            .step {
                margin-bottom: 40vh;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <section id="intro">
        <h1>üèîÔ∏è La Fonte des Glaciers Alpins</h1>
        <p>Une histoire racont√©e par les donn√©es depuis 1900</p>
    </section>

    <section id="scrolly">
        <div class="scroll-graphic">
            <div class="chart-container">
                <svg id="chart"></svg>
            </div>
        </div>

        <div class="scroll-text">
            <div class="step" data-step="0">
                <h2>Un si√®cle de recul</h2>
                <p>En 1900, les glaciers alpins couvraient environ <span class="stat">4 500 km¬≤</span> de territoire.</p>
                <p>Ils symbolisaient une nature √©ternelle et immuable.</p>
            </div>

            <div class="step" data-step="1">
                <h2>Les ann√©es 1950</h2>
                <p>Apr√®s-guerre, les premi√®res mesures scientifiques syst√©matiques d√©butent.</p>
                <p>La surface atteint encore <span class="stat">3 800 km¬≤</span>, mais un l√©ger recul est document√©.</p>
            </div>

            <div class="step" data-step="2">
                <h2>L'acc√©l√©ration (2000)</h2>
                <p>Au tournant du mill√©naire : <span class="stat">2 900 km¬≤</span> seulement subsistent.</p>
                <p>Le rythme s'acc√©l√®re avec le r√©chauffement climatique.</p>
            </div>

            <div class="step" data-step="3">
                <h2>Aujourd'hui (2023)</h2>
                <p>La surface n'est plus que de <span class="stat">2 100 km¬≤</span>.</p>
                <p>Soit <strong>-53% en 123 ans</strong>. Certains glaciers ont disparu.</p>
            </div>

            <div class="step" data-step="4">
                <h2>La Mer de Glace</h2>
                <p>Le plus grand glacier fran√ßais a perdu <span class="stat">120 m√®tres</span> d'√©paisseur depuis 1900.</p>
                <p>Des √©chelles mat√©rialisent ce recul spectaculaire.</p>
            </div>

            <div class="step" data-step="5">
                <h2>Projections 2050</h2>
                <p>Les mod√®les pr√©voient <span class="stat">1 200 km¬≤</span> d'ici 2050.</p>
                <p>Les petits glaciers de basse altitude auront tous disparu.</p>
            </div>
        </div>
    </section>

    <section id="conclusion">
        <h2>üåç Un enjeu vital</h2>
        <p>Les glaciers alpins alimentent les rivi√®res, r√©gulent le climat local et constituent des r√©serves d'eau douce essentielles pour des millions de personnes.</p>
        <p>Leur disparition est un signal d'alarme que nous ne pouvons plus ignorer.</p>
        <p style="margin-top: 2rem; font-style: italic; opacity: 0.9; font-size: 0.9rem;">Sources : WGMS, CNRS, IGN, Swiss Academy of Sciences</p>
    </section>

    <script>
        // Donn√©es
        const data = [
            { year: 1900, area: 4500 },
            { year: 1920, area: 4350 },
            { year: 1940, area: 4200 },
            { year: 1950, area: 3800 },
            { year: 1970, area: 3500 },
            { year: 1990, area: 3200 },
            { year: 2000, area: 2900 },
            { year: 2010, area: 2500 },
            { year: 2023, area: 2100 },
            { year: 2050, area: 1200, projected: true }
        ];

        const svg = d3.select('#chart');
        
        function updateChart(stepIndex) {
            const container = document.querySelector('.chart-container');
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            // Marges adapt√©es √† la taille du container
            const margin = {
                top: Math.max(15, containerHeight * 0.08),
                right: Math.max(10, containerWidth * 0.05),
                bottom: Math.max(25, containerHeight * 0.15),
                left: Math.max(35, containerWidth * 0.12)
            };

            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;

            // Nettoyer
            svg.selectAll('*').remove();
            svg.attr('width', containerWidth)
               .attr('height', containerHeight);

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Donn√©es √† afficher
            let displayData = data.slice(0, Math.min(stepIndex + 3, data.length));
            
            // √âchelles
            const x = d3.scaleLinear()
                .domain([1900, 2050])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, 5000])
                .range([height, 0]);

            // Taille de police adapt√©e
            const baseFontSize = Math.min(width, height) * 0.03;
            const fontSize = Math.max(8, Math.min(12, baseFontSize));
            const isMobile = width < 350;
            
            // Axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x)
                    .tickFormat(d3.format('d'))
                    .ticks(isMobile ? 4 : Math.min(8, Math.floor(width / 60))))
                .attr('class', 'axis')
                .style('font-size', fontSize + 'px');

            g.append('g')
                .call(d3.axisLeft(y)
                    .tickFormat(d => d)
                    .ticks(Math.min(6, Math.floor(height / 40))))
                .attr('class', 'axis')
                .style('font-size', fontSize + 'px');

            // Ligne
            const strokeWidth = Math.max(1.5, Math.min(3, width / 200));

            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.area))
                .curve(d3.curveMonotoneX);

            // Ligne principale
            const path = g.append('path')
                .datum(displayData.filter(d => !d.projected))
                .attr('fill', 'none')
                .attr('stroke', '#667eea')
                .attr('stroke-width', strokeWidth)
                .attr('d', line);

            // Animation
            const totalLength = path.node().getTotalLength();
            path.attr('stroke-dasharray', totalLength + ' ' + totalLength)
                .attr('stroke-dashoffset', totalLength)
                .transition()
                .duration(1000)
                .ease(d3.easeLinear)
                .attr('stroke-dashoffset', 0);

            // Ligne projet√©e
            if (stepIndex >= 5 && displayData.some(d => d.projected)) {
                const projectedData = displayData.filter(d => d.year >= 2023);
                g.append('path')
                    .datum(projectedData)
                    .attr('fill', 'none')
                    .attr('stroke', '#f5576c')
                    .attr('stroke-width', strokeWidth)
                    .attr('stroke-dasharray', '5,5')
                    .attr('d', line);
            }

            // Points
            const dotRadius = Math.max(2.5, Math.min(5, width / 100));

            g.selectAll('.dot')
                .data(displayData.filter(d => !d.projected))
                .enter()
                .append('circle')
                .attr('cx', d => x(d.year))
                .attr('cy', d => y(d.area))
                .attr('r', 0)
                .attr('fill', '#764ba2')
                .transition()
                .delay((d, i) => i * 100)
                .duration(500)
                .attr('r', dotRadius);

            // Point mis en √©vidence
            const highlightYears = [1900, 1950, 2000, 2023, 2023, 2050];
            const highlightYear = highlightYears[stepIndex];
            
            if (highlightYear) {
                const highlightData = displayData.find(d => d.year === highlightYear);
                if (highlightData) {
                    const highlightRadius = dotRadius * 2;
                    
                    g.append('circle')
                        .attr('cx', x(highlightData.year))
                        .attr('cy', y(highlightData.area))
                        .attr('r', 0)
                        .attr('fill', '#f5576c')
                        .attr('stroke', 'white')
                        .attr('stroke-width', strokeWidth)
                        .transition()
                        .duration(500)
                        .attr('r', highlightRadius);

                    // Label
                    const labelFontSize = Math.max(10, Math.min(16, baseFontSize * 1.3));
                    const labelOffset = highlightRadius + 10;

                    g.append('text')
                        .attr('x', x(highlightData.year))
                        .attr('y', y(highlightData.area) - labelOffset)
                        .attr('text-anchor', 'middle')
                        .style('font-weight', 'bold')
                        .style('font-size', labelFontSize + 'px')
                        .style('fill', '#f5576c')
                        .text(highlightData.area + ' km¬≤')
                        .style('opacity', 0)
                        .transition()
                        .duration(500)
                        .style('opacity', 1);
                }
            }

            // Titre (seulement si assez de place)
            if (height > 200) {
                const titleFontSize = Math.max(10, Math.min(14, baseFontSize * 1.2));
                g.append('text')
                    .attr('x', width / 2)
                    .attr('y', -margin.top / 2)
                    .attr('text-anchor', 'middle')
                    .style('font-size', titleFontSize + 'px')
                    .style('font-weight', 'bold')
                    .style('fill', '#333')
                    .text(width > 400 ? '√âvolution de la surface glaciaire alpine' : 'Surface glaciaire');
            }
        }

        // Scrollama
        const scroller = scrollama();

        scroller
            .setup({
                step: '.step',
                offset: 0.5,
                debug: false
            })
            .onStepEnter(response => {
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('is-active');
                });
                response.element.classList.add('is-active');
                updateChart(response.index);
            });

        // Init
        updateChart(0);

        // Redimensionnement avec debounce
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                scroller.resize();
                const activeStep = document.querySelector('.step.is-active');
                if (activeStep) {
                    const stepIndex = parseInt(activeStep.getAttribute('data-step'));
                    updateChart(stepIndex);
                }
            }, 250);
        });
    </script>
</body>
</html>
